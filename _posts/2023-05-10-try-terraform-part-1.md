---
title: "Let's try: Terraform part 1 - basic"
layout: post
author: bluebirz
description: Terraform is one of famous IaaC (Infrastructure as a Code) tools.
date: 2023-05-10
categories: [devops, IaaC]
tags: [Terraform, let's try]
series:
  key: terraform
  index: 1
comment: true
image:
  path: assets/img/features/external/Blueprint-of-Home.jpg
  lqip: ../assets/img/features/lqip/external/Blueprint-of-Home.webp
  alt: DFD HOUSE PLANS BLOG
  caption: <a href="https://www.dfdhouseplans.com/blog/category/house-plans/">DFD HOUSE PLANS BLOG</a>
---

{% include bbz_custom/expand_series.html key=page.series.key index=page.series.index %}

Terraform is one of famous IaaC (Infrastructure as a Code) tools. We can use it to provision, establish, re-organize, until decommission any resources in their supported platform. Of course, including GCP.

---

## Why Terraform?

Cloud providers, for example GCP, have many convenient ways for their users to manage resources. For instance, web UI, `gcloud`, REST API, etc. Terraform is another of them and is very popular in circles of DevOps for do this job.

As its name, "as a Code", it allows to manage like a source code indeed. Versioning, CI/CD, including batching process are all feasible. Goodbye clicking every time and copy-paste to create a VM or else which is risky to human-errors.

Terraform is developed by HashiCorp. And it is open-source. We can visit this link.

{% include bbz_custom/link_preview.html url='<https://www.terraform.io/>' %}

---

## Concepts

Terraform works on the `tf` scripts. There are some facts we need to remember as fundamental.

1. Usually the guide say creating `main.tf`, but there is no filename requirements. Only at least 1 `tf` file must be required.
1. There will be a file named "terraform.tfstate" and "terraform.tfstate.backup". They are state files. Do nothing to them or we will lose all history and tracks. In that case we need to import changes from the real resources.
1. One folder will have only one set of state files. It means ALL `tf` scripts will be executed and we cannot choose which one not to be executed.

---

## Installation

Follow this link and find the method fits you. I myself prefer `brew`.

{% include bbz_custom/link_preview.html url='<https://developer.hashicorp.com/terraform/downloads>' %}

---

## Basic steps

### 1. init

First of all, we need a first `tf` script with a keyword `provider` like this.

<script src="https://gist.github.com/bluebirz/6429b0c6be516584c4dd6035e7401cc8.js?file=main1.tf"></script>

We this time name it "main.tf" but note that we may name it others. And providers supported by Terraform are listed in [this link](https://registry.terraform.io/browse/providers). This time we want to deploy on GCP so we choose "google".

Make sure that we are in the folder then run.

```sh
terraform init
```

It will initialize the backend and provider that we selected. Output should be like this.

![init](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/01-init.png){:style="max-width:75%;margin:auto;"}

Once it completes, we can see a new folder ".terraform" and a new file ".terraform.lock.hcl". They are automatically generated by the command and we have no need to make changes on them.

![terraform folder](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/02-folder.png){:style="max-width:75%;margin:auto;"}

### 2. Add resources

Initialized and now we can manage our resources by editing the "main.tf". The keyword is `resource`.

<script src="https://gist.github.com/bluebirz/6429b0c6be516584c4dd6035e7401cc8.js?file=main2.tf"></script>

The syntax would be:

```terraform
resource "<resource_type>" "<resource_name>" {
  attribute1 = value1
  attribute2 = value2 
}
```

Resource type must be matched with the Terraform registry. Say we are developing on GCP, we can check on [this link](https://registry.terraform.io/providers/hashicorp/google/latest/docs).

Resource name is internal. We can name it whatever. However we should apply naming conventions such as having types, projects, or short purposes.

Attributes depend on resource type. Check the registry for details. Also their values.

### 3. validate

Best practice is to validate before proceeding to next step. Use this command.

```sh
terraform validate
```

It helps a lot to protect any incidents. In case of something wrong, it would notice.

![validate err](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/03-validate-fail.png){:style="max-width:75%;margin:auto;"}

Aha, I forgot `location` that is a required attribute. So I can fix it right now.

<script src="https://gist.github.com/bluebirz/6429b0c6be516584c4dd6035e7401cc8.js?file=main3.tf"></script>

And validate it again.

![validate pass](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/04-validate-pass.png){:style="max-width:75%;margin:auto;"}

Okay we go next.

### 4. Plan

Completed validation then we should plan to review changes.

```sh
terraform plan
```

Terraform will display all changes comparing between the current state and our `tf` scripts. We can double-check what would be changed here. Also we can save the plan for further use.

![plan](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/05-plan.png){:style="max-width:75%;margin:auto;"}

### 5. Apply

The scripts are valid and the changes are satisfied. We can firmly execute this to apply the changes.

```sh
terraform apply
terraform apply -auto-approve
```

With `-auto-approve` flag, we can force apply changes having no need to type "yes" to confirm. However we can skip the flag to review it once again.

![apply](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/06-apply.png){:style="max-width:75%;margin:auto;"}

Now the bucket is created as this figure.

![result](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/07-result1.png){:style="max-width:75%;margin:auto;"}

### 6. State

All existing resources can be listed using the command.

```sh
terraform state list
```

There will be all resources we have applied so far.

![state list](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/08-state.png){:style="max-width:75%;margin:auto;"}

### 7. Destroy

Lastly, if we want to cleanup everything we made. Yes, EVERYTHING. We should run this command.

```sh
terraform destroy
terraform destroy -auto-approve
```

ALL existing resources will be removed. Some resources are protected to remove and we need to check the registry in order to add some attributes for that case if needed.

![destroy](https://bluebirzdotnet.s3.ap-southeast-1.amazonaws.com/terraform/p1/09-destroy.png){:style="max-width:75%;margin:auto;"}

---

Yes, this is just a basic to Terraform. I will update next articles about it.

Hope you find best way to manage your infrastructure as easy as running Terraform.

See ya.
