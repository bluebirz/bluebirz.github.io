{% comment %}See https://talk.jekyllrb.com/t/embedding-opengraph-links-in-posts/8124/6{% endcomment %}
{% assign url = include.url | remove: "<" | remove: ">" %}
{% assign meta = url | metadata %}

<!-- prepare components -->
{% assign title = meta['og:title'] %}{% unless title %}{% assign title = meta['title'] %}{% endunless %}
{% assign desc = meta['og:description'] %}{% unless desc %}{% assign desc = meta['description'] %}{% endunless %}
{% assign image = meta['og:image'] %}
{% assign favicon = meta['apple-touch-icon'] %}
{% assign author = meta['og:site_name'] %}{% unless author %}{% assign author = meta['author'] %}{% endunless %}

<!-- truncate -->
{% assign title = title | truncate 64 | escape %}
{% assign desc = desc | truncate 128 | escape %}

<div class="link-preview-box">
  <a href="{{ url }}" title="{{ meta['title'] | escape }}">
    {% if meta['og:image'] and meta['og:image'] != blank %}
      <img src="{{ meta['og:image'] }}" alt="{{ meta['title'] | escape }}">
    {% else %}
      {% comment %}
        Add a fallback image here, if the opengraph image for given url does not exist. See https://upload.wikimedia.org/wikipedia/commons/f/f5/Antu_edit-image-face-recognize.svg Elegant Alternative Suite for Plasma 5. Ant√º Plasma-KDE Theme are licensed under the CREATIVE COMMONS BY-SA 3.0.
    {% endcomment %}
      <img src="/assets/img/svg/open_graph_default_img.svg" alt="{{ meta['title'] | escape }}">
    {% endif %}

    <p class="link-preview-title">{{ title | truncate: 64 | escape }}</p>
    <p class="link-preview-description">{{ meta['og:description'] | truncate: 128 | escape }}</p>
    <p>{{ meta }}</p>
  </a>
</div>

<figure class="kg-card kg-bookmark-card">
  <a class="kg-bookmark-container" href="{{ url }}" target="_blank" rel="noopener">
    <div class="kg-bookmark-content">
      <div class="kg-bookmark-title">{{ title | escape }}</div>
      <div class="kg-bookmark-description">{{ desc | truncate: 128 | escape }}</div>
      <div class="kg-bookmark-metadata">
        <img class="kg-bookmark-icon" src="https://www.terraform.io/favicon.ico" alt="">
        <span class="kg-bookmark-author">{{ site }}</span>
      </div>
    </div>
    <div class="kg-bookmark-thumbnail">
      {% if meta['og:image'] and meta['og:image'] != blank %}
      <img src="{{ meta['og:image'] }}" alt="">
      {% else %}
      <img src="/assets/img/svg/open_graph_default_img.svg" alt="{{ meta['title'] | escape }}">
      {% endif %}
    </div>
  </a>
</figure>

